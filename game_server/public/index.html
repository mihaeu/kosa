<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Kosa Viewer</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>

    <div id="map">
        <div class="hexagon homebase row0 column1-5" id="green">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon homebase row0 column4-5" id="blue">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>

        <div class="hexagon mountain row1 column1-0" id="m1">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon farm row1 column2-0" id="f1">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon village row1 column3-0" id="v1">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon woods row1 column4-0" id="w1">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon tundra row1 column5-0" id="t1">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon village row1 column6-0" id="v2">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>

        <div class="hexagon lake row2 column0-5" id="l1">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon tundra row2 column1-5" id="t2">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon lake row2 column2-5" id="l2">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon tundra row2 column3-5" id="t3">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon mountain row2 column4-5" id="m2">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon farm row2 column5-5" id="f2">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon farm row2 column6-5" id="f3">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>

        <div class="hexagon homebase row3 column0-0" id="white">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon woods row3 column1-0" id="w2">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon mountain row3 column2-0" id="m3">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon woods row3 column3-0" id="w3">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon lake row3 column4-0" id="l4">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon woods row3 column5-0" id="w4">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon village row3 column6-0" id="v3">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon homebase row3 column7-0" id="red">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>

        <div class="hexagon farm row4 column0-5" id="f4">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon village row4 column1-5" id="v4">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon lake row4 column2-5" id="l5">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon factory row4 column3-5" id="F">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon mountain row4 column4-5" id="m4">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon tundra row4 column5-5" id="t4">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon mountain row4 column6-5" id="m5">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>

        <div class="hexagon woods row5 column0-0" id="w5">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon woods row5 column1-0" id="w6">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon farm row5 column2-0" id="f5">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon tundra row5 column3-0" id="t5">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon lake row5 column4-0" id="l6">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon village row5 column5-0" id="v5">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon lake row5 column6-0" id="l7">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>

        <div class="hexagon mountain row6 column0-5" id="m6">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon village row6 column1-5" id="v6">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon village row6 column2-5" id="v7">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon tundra row6 column3-5" id="t6">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon woods row6 column4-5" id="w7">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon mountain row6 column5-5" id="m7">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon tundra row6 column6-5" id="t7">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>

        <div class="hexagon homebase row7 column0-0" id="black">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon tundra row7 column1-0" id="t8">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon lake row7 column2-0" id="l3">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon farm row7 column3-0" id="f6">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon mountain row7 column4-0" id="m8">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon village row7 column5-0" id="v8">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon farm row7 column6-0" id="f7">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon homebase row7 column7-0" id="purple">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>

        <div class="hexagon homebase row8 column2-5" id="yellow">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
        <div class="hexagon village row8 column3-5" id="v9">
            <div class="content">
                <div class="units"></div>
                <div class="resources"></div>
            </div>
        </div>
    </div>

    <aside>
        <h1>Game</h1>
        <label for="gameId">
            Game UUID
            <input type="text" name="gameId" id="gameId">
        </label>
        <button type="submit" id="load">Load / Refresh</button>
        <label for="auto-refresh">
            Auto-Reload
            <input type="checkbox" id="auto-refresh" name="auto-refresh">
        </label>
        <span id="result"></span>

        <h1>Stats</h1>
        <table>
            <thead>
                <tr>
                    <th class="uuid">Player</th>
                    <th>Faction</th>
                    <th>Player Mat</th>
                    <th>Coins</th>
                    <th>Popularity</th>
                    <th>Power</th>
                    <th>Stars</th>
                    <th>Score</th>
                    <th>Combat Cards</th>
                </tr>
            </thead>
            <tbody id="stats">

            </tbody>
        </table>

        <section id="log-container">
            <h1>Log (reversed)</h1>
            <table>
                <thead>
                <tr>
                    <th class="uuid">UUID</th>
                    <th>Event</th>
                </tr>
                </thead>
                <tbody id="log">

                </tbody>
            </table>
        </section>
    </aside>
    <script>
      (function() {

        const load = (gameId) => fetch(`/load?gameId=${gameId}`)
          .then((res) => {
              const success = res.status === 200;
              document.getElementById("result").innerHTML = success
                ? '✓'
                : '✗';
              if (!success) {
                return;
              }

              res.json().then((data) => {

                const logElement = document.getElementById("log");
                const statsElement = document.getElementById("stats");
                for (const el of document.querySelectorAll(".units, .resources")) {
                  el.innerHTML = "";
                }

                logElement.innerHTML = "";
                statsElement.innerHTML = "";

                for (const event of data.log.reverse()) {
                  logElement.innerHTML += `
                    <tr>
                        <td class="uuid">${event.id}</td>
                        <td class="event">${JSON.stringify(event, null, '    ')}</td>
                    </tr>
                  `;
                }
                for (const playerStats of data.players) {
                  statsElement.innerHTML += `
                    <tr>
                        <td class="uuid">${playerStats.playerId}</td>
                        <td>${playerStats.faction}</td>
                        <td>${playerStats.playerMat}</td>
                        <td>${playerStats.coins}</td>
                        <td>${playerStats.popularity}</td>
                        <td>${playerStats.power}</td>
                        <td>${playerStats.stars}</td>
                        <td>${playerStats.score}</td>
                        <td>${playerStats.combatCards}</td>
                    </tr>
                  `;
                  for (const unit of playerStats.units) {
                    document.querySelector(`#${unit[1].name} .units`).innerHTML += unit[0].name.replace(/(HARACTER|ORKER_|ECH_)/, '');
                  }
                }

                for (const resource of data.resources) {
                  document.querySelector(`#${resource.location.name} .resources`).innerHTML += resource.type.substring(0, 1);
                }

              });
            })
          .catch(console.error);

        const gameId = () => document.getElementById("gameId").value;

        document.getElementById("load").onclick = () => load(gameId()) && false;

        let interval = 0;
        document.getElementById("auto-refresh").onchange = () => {
          if (document.getElementById("auto-refresh").checked) {
            interval = setInterval(() => load(gameId()), 500);
          } else {
            clearInterval(interval);
          }
        };
      })();
    </script>
</body>
</html>
